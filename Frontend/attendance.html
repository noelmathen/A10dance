<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A10dance - Attendance</title>
    <script src="./common.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            /*display: flex;*/
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .welcome-message {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            margin-top: 20px;
            /* Increased for spacing */
        }

        table {
            width: 80%;
            border-collapse: collapse;
            font-family: Arial, sans-serif;
            margin: auto;
            /* Added margin for spacing */
        }

        th,
        td {
            border: 1px solid #dddddd;
            text-align: center;
            padding: 8px;
        }

        th {
            background-color: #f2f2f2;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:hover {
            background-color: #f2f2f2;
        }

        .attendance-button {
            text-align: center;
            margin-top: 20px; /* Adjust as needed */
        }
    
        .attendance-button button {
            background-color: #a831a8; /* Green */
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 10px;
            transition-duration: 0.4s;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        }
    
        .attendance-button button:hover {
            background-color: #ae0c86; /* Darker Green */
        }
    </style>
</head>

<body>
    <div class="attendance-container">
        <div class="welcome-message">Welcome <span id="username"></span></div>
        <br><br>
        <div class="welcome-message">Attendance Table</div>
        <table id="attendance-table">
            <thead>
                <tr>
                    <th>Date/Hours</th>
                    <th>1</th>
                    <th>2</th>
                    <th>3</th>
                    <th>4</th>
                    <th>5</th>
                    <th>6</th>
                    <th>7</th>
                </tr>
            </thead>
            <tbody>
                <!-- Attendance data will be inserted here dynamically -->
            </tbody>
        </table>

        <br><br>
        <div class="welcome-message">Percentage Details</div>
        <table id="attendance-details-table">
            <thead>
                <tr>
                    <th>Sl No</th>
                    <th>Code</th>
                    <th>Subject</th>
                    <th>Hours Lost</th>
                    <th>Percentage</th>
                </tr>
            </thead>
            <tbody>
                <!-- Dynamic table rows will be inserted here -->
            </tbody>
        </table>
        </table>
    </div>

    <div class="attendance-button">
        <button onclick="ViewClassAttendance()">View Class Attendance</button>
    </div>

    <script>
        const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
        if (loggedInUser && loggedInUser.first_name) {
            document.getElementById('username').textContent = loggedInUser.first_name;
        }


        // Fetch attendance data from backend API
        fetch(SERVER_URL + 'attendance-table/', {
            method: 'GET',
            headers: {
                'Authorization': `Token ${loggedInUser.token}`
            }
        })
            .then(response => response.json())
            .then(data => {
                const tableBody = document.querySelector('#attendance-table tbody');

                // Iterate over each attendance record and create table rows dynamically
                data.forEach(record => {
                    const row = document.createElement('tr');

                    // Add date to the first cell
                    const dateCell = document.createElement('td');
                    dateCell.textContent = record.date;
                    row.appendChild(dateCell);

                    // Add attendance details to each hour cell
                    for (let i = 1; i <= 7; i++) {
                        const hourCell = document.createElement('td');
                        //hourCell.textContent = record[`hour_${i}`] ? `${record[`hour_${i}`].course_code} - ${record[`hour_${i}`].course_name}` : '';
                        hourCell.textContent = record[`hour_${i}`] ? `${record[`hour_${i}`].course_code}` : '';
                        row.appendChild(hourCell);
                    }

                    tableBody.appendChild(row);
                });
            })
            .catch(error => console.error('Error fetching attendance data:', error));


        // Fetch attendance details data from backend API
        fetch(SERVER_URL + 'attendance-stats/', {
            method: 'GET',
            headers: {
                'Authorization': `Token ${loggedInUser.token}`
            }
        })
            .then(response => response.json()) // Corrected 'respFonse' to 'response'
            .then(data => {
                const tableBody = document.querySelector('#attendance-details-table tbody');

                // Iterate over each attendance details record and create table rows dynamically
                data.forEach((record, index) => {
                    const row = document.createElement('tr');

                    // Add Sl No to the first cell
                    const slNoCell = document.createElement('td');
                    slNoCell.textContent = index + 1;
                    row.appendChild(slNoCell);

                    // Add course code to the second cell
                    const codeCell = document.createElement('td');
                    codeCell.textContent = record.course.course_code;
                    row.appendChild(codeCell);

                    // Add course name to the third cell
                    const subjectCell = document.createElement('td');
                    subjectCell.textContent = record.course.course_name;
                    row.appendChild(subjectCell);

                    // Add hours lost to the fourth cell
                    const hoursLostCell = document.createElement('td');
                    hoursLostCell.textContent = record.hours_lost_with_duty;
                    row.appendChild(hoursLostCell);

                    // Add percentage to the fifth cell
                    const percentageCell = document.createElement('td');
                    percentageCell.textContent = record.percentage_of_subject;
                    row.appendChild(percentageCell);

                    tableBody.appendChild(row);
                });
            })
            .catch(error => console.error('Error fetching attendance details data:', error));

            function ViewClassAttendance(){
                window.location.href = "./branch_hour_details.html";
            }
    </script>
</body>

</html>